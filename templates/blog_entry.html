{% extends 'base.html' %}

{% block description %}ブログ記事“{{ entry.title }}”のページです。{% endblock %}
{% block keywords %},ブログ,{{ ','.join(entry.tags) }}{% endblock %}
{% block og_title %}ブログ記事: {{ entry.title }}｜{% endblock %}
{% block og_description %}ブログ記事“{{ entry.title }}”のページです。{% endblock %}
{% block title %}ブログ記事: {{ entry.title }}｜{% endblock %}

{% block head %}
	<link rel="stylesheet" href="/css/markdown.css" />
	<style>
		#blog-header {
			margin: 60px 0 30px 0;
		}
		#blog-header h1 {
			color: #000;
			font-size: 28px;
			line-height: 1.4;
			font-weight: normal;
			text-shadow: 0 2px 1px #fff;
			margin: -3px 0 20px 0;
			padding: 0;
		}
		#blog-header p.meta {
			font-size: 13px;
			margin: 0 0 10px 0;
			padding: 0;
		}
		#blog-header p.meta .separator {
			color: #ccc;
			padding: 0 10px;
		}
		#blog-header ul.tags {
			margin: 0 0 0 -2px;
			padding: 0;
		}
		#blog-header ul.tags li {
			display: inline-block;
			float: left;
			font-size: 13px;
			line-height: 1.6;
			list-style: none;
			margin: 2px;
		}
		#blog-header ul.tags li a {
			display: block;
			color: #ff9326;
			font-size: 11px;
			line-height: 1;
			text-decoration: none;
			background-color: #fdf5ef;
			border: 1px solid #ff9326;
			border-radius: 3px;
			padding: 3px 5px;
		}
		#blog-header ul.tags li a:hover {
			background-color: #fff;
		}

		#tweet p.tweetnav {
			color: #999;
			margin: 0 0 10px 0;
			padding: 0;
		}
		#tweet p.tweetnav .pagenate {
			font-size: 20px;
			padding-left: 20px;
		}
		#tweet p.tweetnav .pagenate:hover {
			cursor: pointer;
		}
		#tweet p.tweetnav .pagenate.disabled {
			color: #ddd;
		}
		#tweet p.tweetnav .pagenate.disabled:hover {
			cursor: default;
		}
		#tweet p.tweetnav .pageinfo {
			font-size: 13px;
			padding-left: 30px;
		}
		#tweet .slidearea {
			width: 880px;
			height: 230px;
			overflow: hidden;
		}
		#tweet .slidearea .slidebox {

		}

		.pagination {
			margin-top: 30px;
		}

		.comments {
			margin-top: 120px !important;
		}
	</style>
	<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
	<script>
		$(function() {
			var currentTweet = 1;
			var tweetLength = {{ entry.twitter_ids | length }};
			$('#tweet').find('.pagenate-prev').addClass('disabled');

			setInterval(function() {
				$('.twitter-tweet-rendered').css({
					maxWidth: '100%',
					width: '860px'
				});
				adjustBoxHeight(currentTweet - 1);
			}, 100);

			$('#tweet').find('.pagenate').click(function() {
				$next = $('#tweet').find('.pagenate-next');
				$prev = $('#tweet').find('.pagenate-prev');
				var operator = 0;
				if ($(this).hasClass('pagenate-next')) {
					if (currentTweet < tweetLength) {
						operator = 1
						$prev.removeClass('disabled');
					}
				} else {
					if (currentTweet > 1) {
						operator = -1
						$next.removeClass('disabled');
					}
				}
				if (operator != 0) {
					var offset = $('.slidebox iframe').eq(currentTweet + (operator == 1 ? -1 : -2)).outerHeight();
					currentTweet += operator;
					$('#tweet').find('.slidebox').animate({
						marginTop: (operator == 1 ? '-=' : '+=') + String(offset + 10) + 'px'
					}, function() {
						adjustBoxHeight(currentTweet - 1);
						$('#tweet').find('.pageinfo').text('tweet ' + currentTweet + ' of ' + tweetLength);
					});
					if (currentTweet == tweetLength) {
						$next.addClass('disabled');
					} else if (currentTweet == 1) {
						$prev.addClass('disabled');
					}
				}
			});
		});

		function adjustBoxHeight(index) {
			var boxHeight = $('.slidebox iframe').eq(index).outerHeight();
			$('.slidearea').css({
				height: String(boxHeight + 25) + 'px'
			});
		}

		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&appId=291896374323653&version=v2.0";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>
{% endblock %}

{% block content %}
	<header id="blog-header">
		<h1>{{ entry.title }}</h1>
		<p class="meta"><span class="date"><span class="glyphicon glyphicon-time"></span> {{ entry.date | datetime2jdate(True) }}</span><span class="separator">｜</span><span class="views"><span class="glyphicon glyphicon-eye-open"></span> {{ entry.views }}</span></p>
	{% if entry.tags | length %}
		<ul class="tags clearfix">
			<li><span class="glyphicon glyphicon-tag"></span></li>
		{% for tag in entry.tags %}
			<li><a href="#">{{ tag }}</a></li>
		{% endfor %}
		</ul>
	{% endif %}
	</header>
{% if entry.twitter_ids | length %}
	<div id="tweet">
	{% if entry.twitter_ids | length > 1 %}
		<p class="tweetnav"><span class="glyphicon glyphicon-chevron-up pagenate pagenate-next"></span><span class="glyphicon glyphicon-chevron-down pagenate pagenate-prev"></span><span class="pageinfo">tweet 1 of {{ entry.twitter_ids | length }}</span></p>
	{% endif %}
		<div class="slidearea">
			<div class="slidebox">
			{% for id in entry.twitter_ids %}
				<blockquote class="twitter-tweet" lang="ja"><a href="https://twitter.com/mnemoniccojp/statuses/{{ id }}"></a></blockquote>
			{% endfor %}
			</div>
		</div>
	</div>
{% endif %}
	<section class="section markdown">
		{{ entry.body | mark2html }}
	</section>
	<section class="section pagination">
		<ul class="pager">
		{% if previous %}
			<li class="left">&laquo; <a href="/blog/{{ previous.id() }}">古い記事</a></li>
		{% endif %}
		{% if next %}
			<li class="right"><a href="/blog/{{ next.id() }}">新しい記事</a> &raquo;</li>
		{% endif %}
		</ul>
	</section>
	<section class="section comments">
		<div class="fb-comments" data-href="{{ request_url }}" data-numposts="5" data-colorscheme="light" data-width="860"></div>
	</section>
{% endblock %}