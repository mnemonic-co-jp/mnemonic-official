{% extends 'base.html' %}

{% block title %}ブログ記事: {{ title }}｜{% endblock %}

{% block head %}
	<link rel="stylesheet" href="/css/blog.css" />
	<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
	<script>
		$(function() {
			var currentTweet = 1;
			var tweetLength = {{ entry.twitter_ids | length }};
			$('#tweet').find('.pagenate-prev').addClass('disabled');

			setInterval(function() {
				$('.twitter-tweet-rendered').css({
					maxWidth: '100%',
					width: '860px'
				});
			}, 100);

			$('#tweet').find('.pagenate').click(function() {
				$next = $('#tweet').find('.pagenate-next');
				$prev = $('#tweet').find('.pagenate-prev');
				var operator = 0;
				if ($(this).hasClass('pagenate-next')) {
					if (currentTweet < tweetLength) {
						operator = 1
						$prev.removeClass('disabled');
					}
				} else {
					if (currentTweet > 1) {
						operator = -1
						$next.removeClass('disabled');
					}
				}
				if (operator != 0) {
					currentTweet += operator;
					$('#tweet').find('.slidebox').animate({
						marginTop: (operator == 1 ? '-' : '+') + '=222px'
					}, function() {
						$('#tweet').find('.pageinfo').text('tweet ' + currentTweet + ' of ' + tweetLength);
					});
					if (currentTweet == tweetLength) {
						$next.addClass('disabled');
					} else if (currentTweet == 1) {
						$prev.addClass('disabled');
					}
				}
			});
		});
	</script>
{% endblock %}

{% block content %}
	<header id="blog-header">
		<h1>{{ entry.title }}</h1>
		<p class="meta"><span class="date"><span class="glyphicon glyphicon-time"></span> {{ entry.date | datetime2JDate }}</span><span class="separator">｜</span><span class="views"><span class="glyphicon glyphicon-eye-open"></span> {{ entry.views }}</span></p>
	{% if entry.tags | length %}
		<ul class="tags clearfix">
			<li><span class="glyphicon glyphicon-tag"></span></li>
		{% for tag in entry.tags %}
			<li><a href="#">{{ tag }}</a></li>
		{% endfor %}
		</ul>
	{% endif %}
	</header>
{% if entry.twitter_ids | length %}
	<div id="tweet">
	{% if entry.twitter_ids | length > 1 %}
		<p class="tweetnav"><span class="glyphicon glyphicon-chevron-up pagenate pagenate-next"></span><span class="glyphicon glyphicon-chevron-down pagenate pagenate-prev"></span><span class="pageinfo">tweet 1 of {{ entry.twitter_ids | length }}</span></p>
	{% endif %}
		<div class="slidearea">
			<div class="slidebox">
			{% for id in entry.twitter_ids %}
				<blockquote class="twitter-tweet" lang="ja"><a href="https://twitter.com/mnemoniccojp/statuses/{{ id }}"></a></blockquote>
			{% endfor %}
			</div>
		</div>
	</div>
{% endif %}
	<section class="section markdown-body">
		{{ entry.body | mark2html }}
	</section>
{% endblock %}